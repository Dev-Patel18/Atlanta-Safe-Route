import javax.servlet.ServletException;
import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.http.HttpServletResponse;
import java.io.IOException;

public class OpenRouteServiceServlet extends HttpServlet {
    @Override
    protected void doGet(HttpServletRequest req, HttpServletResponse resp) throws ServletException, IOException {
        String origin = req.getParameter("origin");
        String destination = req.getParameter("destination");
        String safetyLevel = req.getParameter("safetyLevel");

        System.out.println("Received request for origin: " + origin + " and destination: " + destination + " with safety level: " + safetyLevel);

        try {
            // Determine avoid areas based on safety level
            String[][] avoidAreas = getAvoidAreas(safetyLevel);

            // Call the RoutePlanner class to get the route
            String route = RoutePlanner.getRoute(origin, destination, avoidAreas);
            resp.setContentType("application/json");
            resp.getWriter().println(route);
        } catch (Exception e) {
            e.printStackTrace(); // Print stack trace for debugging
            resp.setStatus(HttpServletResponse.SC_INTERNAL_SERVER_ERROR);
            resp.getWriter().println("{\"error\":\"" + e.getMessage() + "\"}");
        }
    }

    private String[][] getAvoidAreas(String safetyLevel) {
        if ("safe".equalsIgnoreCase(safetyLevel)) {
            // Avoid high crime areas
            return new String[][] {
                    {"33.848672,-84.369034", "33.849672,-84.369034", "33.848672,-84.368034", "33.849672,-84.368034"}, // PEACHTREE RD NE
                    {"33.636719,-84.446863", "33.637719,-84.446863", "33.636719,-84.445863", "33.637719,-84.445863"}, // SPINE RD
                    {"33.640411,-84.419853", "33.641411,-84.419853", "33.640411,-84.418853", "33.641411,-84.418853"}, // N TERMINAL PKWY
                    {"33.640732,-84.432788", "33.641732,-84.432788", "33.640732,-84.431788", "33.641732,-84.431788"}, // S TERMINAL PKWY
                    {"33.773906,-84.364428", "33.774906,-84.364428", "33.773906,-84.363428", "33.774906,-84.363428"}, // PONCE DE LEON AVE NE
                    {"33.695572,-84.497080", "33.696572,-84.497080", "33.695572,-84.496080", "33.696572,-84.496080"}, // GREENBRIAR PKWY SW
                    {"33.640742,-84.454927", "33.641742,-84.454927", "33.640742,-84.453927", "33.641742,-84.453927"}, // GLOBAL GATEWAY CONN
                    {"33.752117,-84.400734", "33.753117,-84.400734", "33.752117,-84.399734", "33.753117,-84.399734"}, // FORSYTH ST SW
                    {"33.817736,-84.366458", "33.818736,-84.366458", "33.817736,-84.365458", "33.818736,-84.365458"}, // PIEDMONT RD NE
                    {"33.767959,-84.412484", "33.768959,-84.412484", "33.767959,-84.411484", "33.768959,-84.411484"}, // MARIETTA ST NW
                    {"33.794181,-84.411704", "33.795181,-84.411704", "33.794181,-84.410704", "33.795181,-84.410704"}, // HOWELL MILL RD NW
                    {"33.746600,-84.393910", "33.747600,-84.393910", "33.746600,-84.392910", "33.747600,-84.392910"}, // PEACHTREE ST SW
                    {"33.749208,-84.378866", "33.750208,-84.378866", "33.749208,-84.377866", "33.750208,-84.377866"}  // JESSE HILL JR DR SE
            };
        } else if ("very_safe".equalsIgnoreCase(safetyLevel)) {
            // Avoid both high and moderate crime areas
            return new String[][] {
                    {"33.848672,-84.369034", "33.849672,-84.369034", "33.848672,-84.368034", "33.849672,-84.368034"}, // PEACHTREE RD NE
                    {"33.636719,-84.446863", "33.637719,-84.446863", "33.636719,-84.445863", "33.637719,-84.445863"}, // SPINE RD
                    {"33.640411,-84.419853", "33.641411,-84.419853", "33.640411,-84.418853", "33.641411,-84.418853"}, // N TERMINAL PKWY
                    {"33.640732,-84.432788", "33.641732,-84.432788", "33.640732,-84.431788", "33.641732,-84.431788"}, // S TERMINAL PKWY
                    {"33.773906,-84.364428", "33.774906,-84.364428", "33.773906,-84.363428", "33.774906,-84.363428"}, // PONCE DE LEON AVE NE
                    {"33.695572,-84.497080", "33.696572,-84.497080", "33.695572,-84.496080", "33.696572,-84.496080"}, // GREENBRIAR PKWY SW
                    {"33.640742,-84.454927", "33.641742,-84.454927", "33.640742,-84.453927", "33.641742,-84.453927"}, // GLOBAL GATEWAY CONN
                    {"33.752117,-84.400734", "33.753117,-84.400734", "33.752117,-84.399734", "33.753117,-84.399734"}, // FORSYTH ST SW
                    {"33.817736,-84.366458", "33.818736,-84.366458", "33.817736,-84.365458", "33.818736,-84.365458"}, // PIEDMONT RD NE
                    {"33.767959,-84.412484", "33.768959,-84.412484", "33.767959,-84.411484", "33.768959,-84.411484"}, // MARIETTA ST NW
                    {"33.794181,-84.411704", "33.795181,-84.411704", "33.794181,-84.410704", "33.795181,-84.410704"}, // HOWELL MILL RD NW
                    {"33.746600,-84.393910", "33.747600,-84.393910", "33.746600,-84.392910", "33.747600,-84.392910"}, // PEACHTREE ST SW
                    {"33.749208,-84.378866", "33.750208,-84.378866", "33.749208,-84.377866", "33.750208,-84.377866"}, // JESSE HILL JR DR SE
                    {"33.639523,-84.444165", "33.640523,-84.444165", "33.639523,-84.443165", "33.640523,-84.443165"}, // RENTAL CAR CENTER PKWY
                    {"33.737015,-84.414288", "33.738015,-84.414288", "33.737015,-84.413288", "33.738015,-84.413288"}, // OAK ST SW
                    {"33.771673,-84.412850", "33.772673,-84.412850", "33.771673,-84.411850", "33.772673,-84.411850"}, // NORTHSIDE DR NW
                    {"33.735537,-84.385776", "33.736537,-84.385776", "33.735537,-84.384776", "33.736537,-84.384776"}, // CAPITOL AVE SE
                    {"33.778488,-84.382162", "33.779488,-84.382162", "33.778488,-84.381162", "33.779488,-84.381162"}, // PARK DR NE
                    {"33.747135,-84.411265", "33.748135,-84.411265", "33.747135,-84.410265", "33.748135,-84.410265"}, // OAK ST SW (second entry)
                    {"33.764188,-84.432405", "33.765188,-84.432405", "33.764188,-84.431405", "33.765188,-84.431405"}, // SIMPSON RD NW
                    {"33.817438,-84.425855", "33.818438,-84.425855", "33.817438,-84.424855", "33.818438,-84.424855"}, // DEFOORS FERRY RD NW
                    {"33.747415,-84.407983", "33.748415,-84.407983", "33.747415,-84.406983", "33.748415,-84.406983"}, // LEE ST SW
                    {"33.679697,-84.428456", "33.680697,-84.428456", "33.679697,-84.427456", "33.680697,-84.427456"}, // CLEVELAND AVE SW
                    {"33.755725,-84.369507", "33.756725,-84.369507", "33.755725,-84.368507", "33.756725,-84.368507"}, // EDGEWOOD AVE SE
                    {"33.665678,-84.456370", "33.666678,-84.456370", "33.665678,-84.455370", "33.666678,-84.455370"}, // GODBY RD SW
                    {"33.764944,-84.455643", "33.765944,-84.455643", "33.764944,-84.454643", "33.765944,-84.454643"}, // HARWELL RD NW
                    {"33.771671,-84.421911", "33.772671,-84.421911", "33.771671,-84.420911", "33.772671,-84.420911"}, // DONALD LEE HOLLOWELL PKWY NW
                    {"33.773906,-84.364428", "33.774906,-84.364428", "33.773906,-84.363428", "33.774906,-84.363428"}, // PONCE DE LEON AVE NE (second entry)
                    {"33.798803,-84.393899", "33.799803,-84.393899", "33.798803,-84.392899", "33.799803,-84.392899"}, // BISHOP ST NW
                    {"33.738541,-84.421698", "33.739541,-84.421698", "33.738541,-84.420698", "33.739541,-84.420698"}, // LANGHORN ST SW
                    {"33.775707,-84.388374", "33.776707,-84.388374", "33.775707,-84.387374", "33.776707,-84.387374"}, // SPRING ST NW
                    {"33.773906,-84.364428", "33.774906,-84.364428", "33.773906,-84.363428", "33.774906,-84.363428"}, // PEACHTREE ST NE
                    {"33.780072,-84.462244", "33.781072,-84.462244", "33.780072,-84.461244", "33.781072,-84.461244"}  // AUSTELL RD SW
            };
        }
        return null; // No avoid areas for fastest route
    }
}

